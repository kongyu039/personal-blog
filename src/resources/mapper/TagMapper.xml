<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="pvt.example.mapper.TagMapper">
  <!--实体映射-->
  <resultMap id="base_result_map" type="pvt.example.pojo.entity.Tag">
    <id column="id" property="id" />
  </resultMap>
  <!-- 获取所有Tags标签 -->
  <select id="selectTags" resultType="pvt.example.pojo.entity.Tag">
    SELECT id, name
    FROM tags
  </select>
  <!-- 查询Tag通过PostId -->
  <select id="selectTagsByPostId" parameterType="java.lang.Long" resultType="pvt.example.pojo.entity.Tag">
    SELECT id, name
    FROM tags
           JOIN tags_posts ON tags.id = tags_posts.tag_id
    WHERE tags_posts.post_id = #{postId}
  </select>
  <!-- 增加 Tag 返回生成的主键Id -->
  <insert id="insertTag" parameterType="pvt.example.pojo.entity.Tag" keyProperty="id" useGeneratedKeys="true">
    INSERT INTO tags
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="name != null and name.length()>0">name,</if>
    </trim>
    VALUES
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="name != null and name.length()>0">#{name},</if>
    </trim>
  </insert>
  <!-- 通过id删除tag标签 -->
  <delete id="deleteTagById">
    DELETE FROM tags
    WHERE id IN
    <foreach collection="array" item="id" open="(" separator="," close=")">#{id}</foreach>
  </delete>
  <!-- 更新 updateTag 通过id -->
  <update id="updateTag">
    UPDATE tags
    <set>
      <if test="name != null">name = #{name},</if>
    </set>
    WHERE id = #{id}
  </update>

</mapper>